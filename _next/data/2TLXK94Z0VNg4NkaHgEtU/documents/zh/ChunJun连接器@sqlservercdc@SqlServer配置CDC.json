{"pageProps":{"content":"\n              <a id=\"SqlServer 配置 CDC\" style='display: block; height: 35px;'></a>\n              <h1>\n                SqlServer 配置 CDC\n              </h1>\n            <p>注：SqlServer 自 2008 版本开始支持 CDC(变更数据捕获)功能，本文基于 SqlServer 2017 编写。</p>\n\n              <a id=\"1、查询 SqlServer 数据库版本\" style='display: block; height: 35px;'></a>\n              <h4>\n                1、查询 SqlServer 数据库版本\n              </h4>\n            <p>SQL：<code>SELECT @@VERSION</code>\n结果：</p>\n<p><img src=\"/chunjun/doc/SqlserverCDC/Sqlserver1.png\" alt=\"image\"></p>\n\n              <a id=\"2、查询当前用户权限，必须为  sysadmin  固定服务器角色的成员才允许对数据库启用 CDC(变更数据捕获)功能\" style='display: block; height: 35px;'></a>\n              <h4>\n                2、查询当前用户权限，必须为  sysadmin  固定服务器角色的成员才允许对数据库启用 CDC(变更数据捕获)功能\n              </h4>\n            <p>SQL：<code>exec sp_helpsrvrolemember &#39;sysadmin&#39;</code>\n结果：</p>\n<p><img src=\"/chunjun/doc/SqlserverCDC/Sqlserver2.png\" alt=\"image\"></p>\n\n              <a id=\"3、查询数据库是否已经启用 CDC(变更数据捕获)功能\" style='display: block; height: 35px;'></a>\n              <h4>\n                3、查询数据库是否已经启用 CDC(变更数据捕获)功能\n              </h4>\n            <p>SQL：<code>select is_cdc_enabled, name from  sys.databases where name = &#39;tudou&#39;</code>\n结果：</p>\n<p><img src=\"/chunjun/doc/SqlserverCDC/Sqlserver3.png\" alt=\"image\"></p>\n<p>0：未启用；1：启用</p>\n\n              <a id=\"4、对数据库数据库启用 CDC(变更数据捕获)功能\" style='display: block; height: 35px;'></a>\n              <h4>\n                4、对数据库数据库启用 CDC(变更数据捕获)功能\n              </h4>\n            <p>SQL：</p>\n<pre><code class=\"language-sql\"><span class=\"hljs-keyword\">USE</span>\ntudou\nGO\n<span class=\"hljs-built_in\">EXEC</span> sys.sp_cdc_enable_db\nGO\n</code></pre>\n<p>重复第三步操作，确认数据库已经启用 CDC(变更数据捕获)功能。</p>\n<p><img src=\"/chunjun/doc/SqlserverCDC/Sqlserver4.png\" alt=\"image\"></p>\n\n              <a id=\"5、查询表是否已经启用 CDC(变更数据捕获)功能\" style='display: block; height: 35px;'></a>\n              <h4>\n                5、查询表是否已经启用 CDC(变更数据捕获)功能\n              </h4>\n            <p>SQL：<code>select name,is_tracked_by_cdc from sys.tables where name = &#39;test&#39;;</code>\n结果：</p>\n<p><img src=\"/chunjun/doc/SqlserverCDC/Sqlserver5.png\" alt=\"image\"></p>\n<p>0：未启用；1：启用</p>\n\n              <a id=\"6、对表启用 CDC(变更数据捕获)功能\" style='display: block; height: 35px;'></a>\n              <h4>\n                6、对表启用 CDC(变更数据捕获)功能\n              </h4>\n            <p>SQL：</p>\n<pre><code class=\"language-sql\"><span class=\"hljs-keyword\">EXEC</span> sys.sp_cdc_enable_table\n<span class=\"hljs-variable\">@source_schema</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&#x27;dbo&#x27;</span>,\n<span class=\"hljs-variable\">@source_name</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&#x27;test&#x27;</span>,\n<span class=\"hljs-variable\">@role_name</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-keyword\">NULL</span>,\n<span class=\"hljs-variable\">@supports_net_changes</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n</code></pre>\n<p>source_schema：表所在的 schema 名称 source_name：表名 role_name：访问控制角色名称，此处为 null 不设置访问控制\nsupports_net_changes：是否为捕获实例生成一个净更改函数，0：否；1：是</p>\n<p>重复第五步操作，确认表已经启用 CDC(变更数据捕获)功能。</p>\n<p><img src=\"/chunjun/doc/SqlserverCDC/Sqlserver6.png\" alt=\"image\"></p>\n<p>至此，表<code>test</code>启动 CDC(变更数据捕获)功能配置完成。</p>\n\n              <a id=\"7、确认 CDC agent 是否正常启动\" style='display: block; height: 35px;'></a>\n              <h4>\n                7、确认 CDC agent 是否正常启动\n              </h4>\n            <pre><code class=\"language-sql\">EXEC master<span class=\"hljs-selector-class\">.dbo</span><span class=\"hljs-selector-class\">.xp_servicecontrol</span> N<span class=\"hljs-string\">&#x27;QUERYSTATE&#x27;</span>, N<span class=\"hljs-string\">&#x27;SQLSERVERAGENT&#x27;</span>\n</code></pre>\n<p><img src=\"/chunjun/doc/SqlserverCDC/Sqlserver16.png\" alt=\"image\"></p>\n<p>如显示上图状态，需要启动对应的 agent.</p>\n<p><strong>Windows 环境操作开启 CDC agent</strong>\n点击 下图位置代理开启</p>\n<p><img src=\"/chunjun/doc/SqlserverCDC/Sqlserver17.png\" alt=\"image\">&gt;</p>\n<p><strong>重新启动数据库</strong></p>\n<p><img src=\"/chunjun/doc/SqlserverCDC/Sqlserver18.png\" alt=\"image\"></p>\n<p><strong>再次查询 agent 状态，确认状态变更为 running</strong></p>\n<p><img src=\"/chunjun/doc/SqlserverCDC/Sqlserver19.png\" alt=\"image\"></p>\n<p>至此，表<code>test</code>启动 CDC(变更数据捕获)功能配置完成。</p>\n<p><strong>docker 环境操作开启 CDC agent</strong></p>\n<p><strong>开启 mssql-server 的代理服务</strong>_</p>\n<pre><code class=\"language-shell\">docker exec -it sqlserver bash\n<span class=\"hljs-regexp\">/opt/m</span>ssql<span class=\"hljs-regexp\">/bin/m</span>ssql-conf set sqlagent.enabled <span class=\"hljs-keyword\">true</span>\ndocker stop sqlserver\ndocker start sqlserver\n</code></pre>\n<p>参考阅读：<a href=\"https://docs.microsoft.com/zh-cn/sql/relational-databases/track-changes/enable-and-disable-change-data-capture-sql-server?view=sql-server-2017\">https://docs.microsoft.com/zh-cn/sql/relational-databases/track-changes/enable-and-disable-change-data-capture-sql-server?view=sql-server-2017</a></p>\n","tree":[{"label":"ChunJun通用配置详解","category":"file"},{"label":"快速开始","category":"file"},{"label":"ChunJun拓展数据格式","children":[{"label":"protobuf-x","path":"protobuf-x","category":"file"}],"category":"dir"},{"label":"ChunJun连接器","children":[{"label":"binlog","category":"dir","children":[{"label":"binlog-source","path":"binlog-source","category":"file"}]},{"label":"clickhouse","category":"dir","children":[{"label":"clickhouse-lookup","path":"clickhouse-lookup","category":"file"},{"label":"clickhouse-sink","path":"clickhouse-sink","category":"file"},{"label":"clickhouse-source","path":"clickhouse-source","category":"file"}]},{"label":"db2","category":"dir","children":[{"label":"db2-lookup","path":"db2-lookup","category":"file"},{"label":"db2-sink","path":"db2-sink","category":"file"},{"label":"db2-source","path":"db2-source","category":"file"}]},{"label":"dm","category":"dir","children":[{"label":"dm-sink","path":"dm-sink","category":"file"},{"label":"dm-source","path":"dm-source","category":"file"}]},{"label":"doris","category":"dir","children":[{"label":"dorisbatch-sink","path":"dorisbatch-sink","category":"file"}]},{"label":"elasticsearch","category":"dir","children":[{"label":"es7-lookup","path":"es7-lookup","category":"file"},{"label":"es7-sink","path":"es7-sink","category":"file"},{"label":"es7-source","path":"es7-source","category":"file"}]},{"label":"gbase","category":"dir","children":[{"label":"gbase-lookup","path":"gbase-lookup","category":"file"},{"label":"gbase-sink","path":"gbase-sink","category":"file"},{"label":"gbase-source","path":"gbase-source","category":"file"}]},{"label":"greenplum","category":"dir","children":[{"label":"greenplum-sink","path":"greenplum-sink","category":"file"},{"label":"greenplum-source","path":"greenplum-source","category":"file"}]},{"label":"hbase","category":"dir","children":[{"label":"hbase-lookup","path":"hbase-lookup","category":"file"},{"label":"hbase-sink","path":"hbase-sink","category":"file"},{"label":"hbase-source","path":"hbase-source","category":"file"}]},{"label":"hdfs","category":"dir","children":[{"label":"hdfs-sink","path":"hdfs-sink","category":"file"},{"label":"hdfs-source","path":"hdfs-source","category":"file"}]},{"label":"hive","category":"dir","children":[{"label":"hive-lookup","path":"hive-lookup","category":"file"},{"label":"hive-sink","path":"hive-sink","category":"file"}]},{"label":"influxdb","category":"dir","children":[{"label":"influxdb-sink","path":"influxdb-sink","category":"file"},{"label":"influxdb-source","path":"influxdb-source","category":"file"}]},{"label":"kafka","category":"dir","children":[{"label":"kafka-sink","path":"kafka-sink","category":"file"},{"label":"kafka-source","path":"kafka-source","category":"file"}]},{"label":"kingbase","category":"dir","children":[{"label":"kingbase-sink","path":"kingbase-sink","category":"file"},{"label":"kingbase-source","path":"kingbase-source","category":"file"}]},{"label":"kudu","category":"dir","children":[{"label":"kudu-lookup","path":"kudu-lookup","category":"file"},{"label":"kudu-sink","path":"kudu-sink","category":"file"},{"label":"kudu-source","path":"kudu-source","category":"file"}]},{"label":"logminer","category":"dir","children":[{"label":"LogMiner-source","path":"LogMiner-source","category":"file"},{"label":"LogMiner原理","path":"LogMiner原理","category":"file"},{"label":"LogMiner配置","path":"LogMiner配置","category":"file"}]},{"label":"mongodb","category":"dir","children":[{"label":"mongodb-lookup","path":"mongodb-lookup","category":"file"},{"label":"mongodb-sink","path":"mongodb-sink","category":"file"},{"label":"mongodb-source","path":"mongodb-source","category":"file"}]},{"label":"mysql","category":"dir","children":[{"label":"mysql-lookup","path":"mysql-lookup","category":"file"},{"label":"mysql-sink","path":"mysql-sink","category":"file"},{"label":"mysql-source","path":"mysql-source","category":"file"}]},{"label":"oracle","category":"dir","children":[{"label":"oracle-lookup","path":"oracle-lookup","category":"file"},{"label":"oracle-sink","path":"oracle-sink","category":"file"},{"label":"oracle-source","path":"oracle-source","category":"file"}]},{"label":"pgwal","category":"dir","children":[{"label":"Postgres-CDC","path":"Postgres-CDC","category":"file"}]},{"label":"postgresql","category":"dir","children":[{"label":"postgres-lookup","path":"postgres-lookup","category":"file"},{"label":"postgres-sink","path":"postgres-sink","category":"file"},{"label":"postgres-source","path":"postgres-source","category":"file"}]},{"label":"rocketmq","category":"dir","children":[{"label":"rocketmq-source","path":"rocketmq-source","category":"file"}]},{"label":"saphana","category":"dir","children":[{"label":"saphana-sink","path":"saphana-sink","category":"file"},{"label":"saphana-source","path":"saphana-source","category":"file"}]},{"label":"sqlserver","category":"dir","children":[{"label":"sqlserver-lookup","path":"sqlserver-lookup","category":"file"},{"label":"sqlserver-sink","path":"sqlserver-sink","category":"file"},{"label":"sqlserver-source","path":"sqlserver-source","category":"file"}]},{"label":"sqlservercdc","category":"dir","children":[{"label":"SqlServer CDC实时采集原理","path":"SqlServer CDC实时采集原理","category":"file"},{"label":"SqlServer配置CDC","path":"SqlServer配置CDC","category":"file"},{"label":"SqlserverCDC-source","path":"SqlserverCDC-source","category":"file"}]}],"category":"dir"},{"label":"开发者指南","children":[{"label":"如何提交一个优秀的PR","path":"如何提交一个优秀的PR","category":"file"},{"label":"如何自定义插件","path":"如何自定义插件","category":"file"}],"category":"dir"},{"label":"拓展功能","children":[{"label":"增量同步介绍","path":"增量同步介绍","category":"file"},{"label":"断点续传介绍","path":"断点续传介绍","category":"file"},{"label":"脏数据插件设计","path":"脏数据插件设计","category":"file"}],"category":"dir"}],"toc":[{"text":"SqlServer 配置 CDC","level":1,"id":"5a156b83-7a68-4388-a67d-b8e22898811e"},{"text":"1、查询 SqlServer 数据库版本","level":4,"id":"39756f61-7213-4a83-b0d3-382e48318a85"},{"text":"2、查询当前用户权限，必须为  sysadmin  固定服务器角色的成员才允许对数据库启用 CDC(变更数据捕获)功能","level":4,"id":"1ef58a2d-3bf9-4187-b3ed-6f197e0c1338"},{"text":"3、查询数据库是否已经启用 CDC(变更数据捕获)功能","level":4,"id":"ccb1da9f-07fc-492a-a2bd-9692b67e0bf0"},{"text":"4、对数据库数据库启用 CDC(变更数据捕获)功能","level":4,"id":"c67faab2-8607-47b0-9223-37ea3464f7aa"},{"text":"5、查询表是否已经启用 CDC(变更数据捕获)功能","level":4,"id":"26877814-2bc9-436f-8f78-296a05acdd9b"},{"text":"6、对表启用 CDC(变更数据捕获)功能","level":4,"id":"3c479d7e-d095-4ca4-b19e-658b6f20a874"},{"text":"7、确认 CDC agent 是否正常启动","level":4,"id":"dc6bef64-8338-47eb-8a71-61d560e4dbab"}]},"__N_SSG":true}