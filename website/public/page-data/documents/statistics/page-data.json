{"componentChunkName":"component---src-pages-documents-markdown-remark-parent-file-name-js","path":"/documents/statistics/","result":{"data":{"markdownRemark":{"html":"<p>ChunJun使用了flink内置Accumulator和Metric来记录任务的一些统计指标：</p>\n<table>\n<thead>\n<tr>\n<th>指标名称</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>numRead</td>\n<td>累计读取数据条数</td>\n</tr>\n<tr>\n<td>byteRead</td>\n<td>累计读取数据字节数</td>\n</tr>\n<tr>\n<td>readDuration</td>\n<td>读取数据的总时间</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>numWrite</td>\n<td>累计写入数据条数</td>\n</tr>\n<tr>\n<td>byteWrite</td>\n<td>累计写入数据字节数</td>\n</tr>\n<tr>\n<td>writeDuration</td>\n<td>写入数据的总时间</td>\n</tr>\n<tr>\n<td>nErrors</td>\n<td>累计错误记录数</td>\n</tr>\n<tr>\n<td>nullErrors</td>\n<td>累计空指针错误记录数</td>\n</tr>\n<tr>\n<td>duplicateErrors</td>\n<td>累计主键冲突错误记录数</td>\n</tr>\n<tr>\n<td>conversionErrors</td>\n<td>累计类型转换错误记录数</td>\n</tr>\n<tr>\n<td>otherErrors</td>\n<td>累计其它错误记录数</td>\n</tr>\n</tbody>\n</table>\n<h3>获取统计指标的方式</h3>\n<h4>1.Local模式运行</h4>\n<p>local模式运行时，任务结束后会在控制台打印这些指标：</p>\n<pre><code>---------------------------------\r\nnumWrite                  |  100\r\nlast_write_num_0          |  0\r\nconversionErrors          |  0\r\nwriteDuration             |  12251\r\nnumRead                   |  100\r\nduplicateErrors           |  0\r\nsnapshotWrite             |  0\r\nreadDuration              |  12247\r\notherErrors               |  0\r\nbyteRead                  |  2329\r\nlast_write_location_0     |  0\r\nbyteWrite                 |  2329\r\nnullErrors                |  0\r\nnErrors                   |  0\r\n---------------------------------\n</code></pre>\n<h4>2.yarn模式运行</h4>\n<h5>2.1 通过Flink REST接口获取</h5>\n<p>任务运行期间，可以通过Flink REST接口获取Accumulator数据，名称和上面给出的一致。</p>\n<p>api：<a href=\"http://host:8088/proxy/application_1569335225689_4172//jobs/d5582272d29ff38e10416a4043a86cad/accumulators\">http://host:8088/proxy/application_1569335225689_4172//jobs/d5582272d29ff38e10416a4043a86cad/accumulators</a></p>\n<p>返回数据示例：</p>\n<pre><code class=\"language-json\">{\r\n    \"job-accumulators\": [],\r\n    \"user-task-accumulators\": [\r\n        {\r\n            \"name\": \"numWrite\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"last_write_num_0\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"conversionErrors\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"writeDuration\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"numRead\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"duplicateErrors\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"snapshotWrite\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"readDuration\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"otherErrors\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"byteRead\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"last_write_location_0\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"byteWrite\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"nullErrors\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        },\r\n        {\r\n            \"name\": \"nErrors\",\r\n            \"type\": \"LongCounter\",\r\n            \"value\": \"0\"\r\n        }\r\n    ],\r\n    \"serialized-user-task-accumulators\": {}\r\n}\n</code></pre>\n<h5>2.2 将指标输出到其它系统</h5>\n<p>比如将指标输出到prometheus，在flink的配置文件里增加配置即可：</p>\n<pre><code>metrics.reporter.promgateway.class: org.apache.flink.metrics.prometheus.PrometheusPushGatewayReporter\r\nmetrics.reporter.promgateway.interval: 500 MILLISECONDS \r\nmetrics.reporter.promgateway.host: 127.0.0.1 \r\nmetrics.reporter.promgateway.port: 9091\r\nmetrics.reporter.promgateway.jobName: testjob\r\nmetrics.reporter.promgateway.randomJobNameSuffix: true\r\nmetrics.reporter.promgateway.deleteOnShutdown: false\n</code></pre>\n<p>通过prometheus获取数据时的名称为：</p>\n<table>\n<thead>\n<tr>\n<th>ChunJun中指标名称</th>\n<th>prometheus中指标名称</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>numRead</td>\n<td>flink_taskmanager_job_task_operator_chunjun_byteRead</td>\n</tr>\n<tr>\n<td>byteRead</td>\n<td>flink_taskmanager_job_task_operator_chunjun_byteRead</td>\n</tr>\n<tr>\n<td>readDuration</td>\n<td>flink_taskmanager_job_task_operator_chunjun_readDuration</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>numWrite</td>\n<td>flink_taskmanager_job_task_operator_chunjun_numWrite</td>\n</tr>\n<tr>\n<td>byteWrite</td>\n<td>flink_taskmanager_job_task_operator_chunjun_byteWrite</td>\n</tr>\n<tr>\n<td>writeDuration</td>\n<td>flink_taskmanager_job_task_operator_chunjun_writeDuration</td>\n</tr>\n<tr>\n<td>nErrors</td>\n<td>flink_taskmanager_job_task_operator_chunjun_nErrors</td>\n</tr>\n<tr>\n<td>nullErrors</td>\n<td>flink_taskmanager_job_task_operator_chunjun_nullErrors</td>\n</tr>\n<tr>\n<td>duplicateErrors</td>\n<td>flink_taskmanager_job_task_operator_chunjun_duplicateErrors</td>\n</tr>\n<tr>\n<td>conversionErrors</td>\n<td>flink_taskmanager_job_task_operator_chunjun_conversionErrors</td>\n</tr>\n<tr>\n<td>otherErrors</td>\n<td>flink_taskmanager_job_task_operator_chunjun_otherErrors</td>\n</tr>\n</tbody>\n</table>","id":"2bb08454-0d28-523b-9449-57a1518a2017","parent":{"id":"8362817b-b412-513f-973b-c3c107e14604","name":"statistics","modifiedTime":"2022-06-07T13:14:12.087Z","ino":3377699721739134}}},"pageContext":{"id":"2bb08454-0d28-523b-9449-57a1518a2017","parent__name":"statistics","__params":{"parent__name":"statistics"}}},"staticQueryHashes":["527733040"]}